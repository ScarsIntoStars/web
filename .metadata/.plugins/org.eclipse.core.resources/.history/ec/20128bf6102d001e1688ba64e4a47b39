<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<div class="row my-5 justify-content-center">
	<div class="col-md-8">
		<h1 class="text-center">상품등록</h1>
		<form class="card p-3" name="frm1">
			<input class="form-control my-2" placeholder="상품이름">
			<input class="form-control my-2" placeholder="상품가격">
			<div>
				<input type="submit" value="상품등록" class="btn btn-primary">
				<input type="reset" value="등록취소" class="btn btn-secondary">
			</div>
		</form>
	</div>
</div>

<script>
	$(frm1).on("submit", function(e){
		e.preventDefault();
		const name=$(frm1.name).val();
		const price=$(frm1.price).val();
		
		if(name=="") {
			alert("상품이름을 입력하세요!");
			$(frm1.name).focus();
		} else if (price=="") {
			alert("상품가격을 입력하세요!");
			$(frm1.price).focus();
		} else if(price.replace(/[0-9]/g, '')) {
		    alert("상품가격을 숫자로 입력하세요!");
		    $(frm1.price).val("");
		    $(frm1.price).focus();
		} else {
			if(confirm("새로운 상품을 등록하실래요?")) {
				$.ajax({
					type:"post",
					url:"/pro/insert",
					data:{"name" :name, "price":price},
					success:function(){
						alert("등록이 완료되었습니다.");
						$(frm1.name).val("");
						$(frm1.price).val("");
						getList();
					}
				});
			} else {
				alert("등록이 취소되었습니다.")
			}
		}
	
	})
	
	
		function getList(){
		$.ajax({
			type:"get",
			url:"/pro/list.json",
			data:{"page":page, "query" : query},
			dataType:"json",
			success:function(data){
				console.log(data);
				const temp=Handlebars.compile($("#temp_product").html());
				const html=temp(data);
				$("#div_product").html(html);
				
				let lastPage = Math.ceil(data.total/5);
				
				
				if(page==1){
					$("#prev").attr("disabled", true) 
				} else {
					$("#prev").attr("disabled", false)
				}
				
				if(page==lastPage) {
					$("#next").attr("disabled", true)
				} else {
					$("#next").attr("disabled", false)
				}
				
				$("#nowPage").html(page + "/" + lastPage);
				
				$("#total").html(data.total +"건");
				
				if(data.total==0) $("#btn-group").hide();
				else $("#btn-group").show();
			}
		});
		
	}
</script>